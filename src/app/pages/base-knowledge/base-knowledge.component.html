<div class="card flex" style="padding: 0; ">
	<p-breadcrumb class="max-w-full" [style]="{'border-radius': '6px'}" [model]="_listMenuItems"
		[home]="_defaultHomeMenu" />
</div>
<div class="knowledge-base-container">
	<p-toast></p-toast>
	<p-confirmDialog></p-confirmDialog>
	<p-card [style]="{'border-radius': '6px'}" styleClass="p-card-shadow">
		<div class="flex items-start gap-2 justify-between">
			<div>
				<div class="text-2xl leading-8 text-color font-medium mb-4">Base Knowledge</div>
			</div>
		</div>

		<p-fieldset legend="Upload Documents" [toggleable]="true" styleClass="p-mb-4">
			<p-fileUpload #fileUploader name="files[]" mode="advanced" [auto]="false" [multiple]="true" accept=".pdf"
				maxFileSize="10000000" chooseLabel="Choose Files" uploadLabel="Upload" cancelLabel="Cancel"
				[customUpload]="true" (uploadHandler)="onUpload($event)" (onSelect)="onFileSelected($event)"
				(onClear)="onFileClear()" (onRemove)="onRemoveFile($event)">
				<ng-template #empty>
					<div>Drag and drop PDF files here to upload.</div>
				</ng-template>
			</p-fileUpload>
		</p-fieldset>

		<p-fieldset legend="ðŸ“‚ Uploaded File" [toggleable]="true" styleClass="p-mb-4">
			<p-listbox class="pListboxKnowledge" [options]="_arrayUploadedFiles" optionLabel="filename"
				[style]="{'width':'100%', 'min-height':'150px'}" [emptyMessage]="'Tidak ada file yang diunggah.'">
				<ng-template let-file pTemplate="item">
					<div class="uploaded-file-item">
						<div class="file-info">
							<span class="filename">{{ file.filename }}</span>
							<span class="upload-date">{{ file.uploaded_at | date:'dd MMM yyyy, HH:mm' }}</span>
							<span class="status">
								<p-tag *ngIf="file.status === 'pending'" icon="pi pi-exclamation-triangle"
									severity="warn" value="Pending Process"></p-tag>
								<p-tag *ngIf="file.status !== 'pending'" icon="pi pi-check" severity="success"
									value="Processed"></p-tag>
							</span>
						</div>
						<div class="file-actions">
							<p-button icon="pi pi-trash"
								styleClass="p-button-danger p-button-rounded p-button-sm p-button-text ml-2"
								(onClick)="confirmRemoveFile($event, file)" pTooltip="Hapus File"
								tooltipPosition="right" [raised]="true">
							</p-button>
						</div>
					</div>
				</ng-template>

			</p-listbox>
			<div class="p-d-flex p-jc-center p-mt-4">
				<p-button label="Process File" icon="pi pi-sync" styleClass="p-button-primary p-button-md"
					[style]="{'margin-top': '15px'}" (onClick)="confirmEmbeddingFile($event)" [raised]="true"
					[disabled]="isProcessDisabled">
				</p-button>
			</div>
		</p-fieldset>

		<p-fieldset legend="ðŸŒ Website Knowledge Base" [toggleable]="true" styleClass="p-mb-4">
			
			<p-listbox class="pListboxKnowledge" [options]="_arrayWebsiteSources" optionLabel="url"
				[style]="{'width':'100%', 'min-height':'150px'}" [emptyMessage]="'Tidak ada sumber website yang ditambahkan.'">
				<ng-template let-source pTemplate="item">
					<div class="uploaded-file-item">
						<div class="file-info">
							<span class="filename">{{ source.url }}</span>
							<span class="upload-date">{{ source.created_at | date:'dd MMM yyyy, HH:mm' }}</span>
							<span class="status">
								<p-tag *ngIf="source.status === 'pending'" icon="pi pi-exclamation-triangle"
									severity="warn" value="Pending Process"></p-tag>
								<p-tag *ngIf="source.status !== 'pending'" icon="pi pi-check" severity="success"
									value="Processed"></p-tag>
							</span>
						</div>
						<div class="file-actions">
							<p-button icon="pi pi-trash"
								styleClass="p-button-danger p-button-rounded p-button-sm p-button-text ml-2"
								(onClick)="confirmRemoveWebsiteSource($event, source)" pTooltip="Hapus Sumber Website"
								tooltipPosition="right" [raised]="true">
							</p-button>
							
						</div>
					</div>
				</ng-template>
			</p-listbox>
			
			<div class="p-d-flex p-jc-center p-mt-4">
				<p-button 
					label="Process Website Embedding" 
					icon="pi pi-sync" 
					styleClass="p-button-primary p-button-md mr-2"
					[style]="{'margin-top': '15px'}" 
					(onClick)="confirmProcessWebsiteEmbedding($event)" 
					[raised]="true"
					[disabled]="isProcessDisabledWeb">
				</p-button>
				<p-button 
					label="Add Website URL" 
					icon="pi pi-plus" 
					styleClass="p-button-primary p-button-md" 
					(onClick)="_showAddUrlDialog = true"/>			
			</div>
		</p-fieldset>

		<p-dialog 
			[(visible)]="_showAddUrlDialog" 
			header="Tambah URL Website" 
			[modal]="true" 
			[style]="{width: '50vw'}"
			class="">
			<div class="p-fluid">
				<label for="newUrl">URL Website</label>
				<input id="newUrl" type="text" class="ml-2" pInputText [(ngModel)]="_newWebsiteUrl">
			</div>
			<ng-template pTemplate="footer">
				<p-button label="Cancel" icon="pi pi-times" styleClass="p-button-secondary" (onClick)="_showAddUrlDialog = false"></p-button>
				<p-button label="Add" icon="pi pi-plus" (onClick)="addWebsiteUrl()"></p-button>
			</ng-template>
		</p-dialog>
	</p-card>
</div>